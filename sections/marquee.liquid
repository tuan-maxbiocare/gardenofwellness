<script
  src="{{ 'marquee.js' | asset_url }}"
  type="module"
  fetchpriority="low"
></script>

{% assign gap_between_elements = section.settings.gap_between_elements %}

<div class="section-background color-{{ section.settings.color_scheme }}"></div>

<marquee-component
  class="section spacing-style gap-style color-{{ section.settings.color_scheme }}"
  style="
    {%- render 'spacing-style', settings: section.settings %};
    {% render 'gap-style', value: gap_between_elements, name: 'marquee-gap' %}
    --marquee-direction: {{ section.settings.movement_direction }};
  "
  data-speed-factor="25"
  data-movement-direction="{{ section.settings.movement_direction }}"
>
  <div class="marquee__wrapper" ref="wrapper">
    <div class="marquee__content" ref="content">
      <div class="marquee__repeated-items" ref="marqueeItems[]">
        {% content_for 'blocks' %}
      </div>
    </div>
  </div>
</marquee-component>

{% stylesheet %}
marquee-component {
  display: block;
  width: 100%;
  overflow: hidden;
  background-color: #6b7a65;
}

.marquee__wrapper {
  display: flex;
  gap: var(--marquee-gap);
  width: max-content;
  white-space: nowrap;
  padding: 10px 0;
}

.marquee__content {
  min-width: max-content;
  display: flex;
  gap: var(--marquee-gap);
}

.marquee__repeated-items {
  min-width: max-content;
  display: flex;
  gap: var(--marquee-gap);
  align-items: center;
  justify-content: center;
}

/* ============================= */
/* TEXT STYLE – CHỈNH THEO Ý MUỐN */
/* ============================= */

.marquee__repeated-items :is(p, h1, h2, h3, h4, h5, h6, span, div) {
  white-space: nowrap;
  text-transform: uppercase;
  font-family: var(--font-body--family);
  font-weight: 800;
  font-size: 40px;
  margin: 0;
  line-height: 1;
  display: block;
}

/* IMAGE STYLE - STYLE CHO ẢNH */
.marquee__repeated-items img,
.marquee__repeated-items .marquee-image {
  display: block;
  height: auto;
  max-height: 60px; /* Có thể điều chỉnh theo ý muốn */
  width: auto;
  object-fit: contain;
}

/* CHỮ ĐẶC */
.marquee-solid {
  color: white !important;
  -webkit-text-stroke: 0 !important;
}

/* CHỮ RỖNG */
.marquee-outline {
  color: transparent !important;
  -webkit-text-stroke: 1.5px white !important;
}

.marquee__content .marquee__repeated-items * {
  max-width: none;
}

.marquee__repeated-items > * {
  align-content: center;
}

/* ============================= */
/* MARQUEE ANIMATION - SỬA LẠI */
/* ============================= */
marquee-component {
  --marquee-speed: 25s;
}

/* Marquee animation hoạt động trên cả desktop & mobile */
marquee-component:not([data-disabled]) .marquee__wrapper {
  animation: marquee-motion var(--marquee-speed) linear infinite;
  animation-direction: var(--marquee-direction, normal);
  will-change: transform; /* Tối ưu hiệu suất animation */
}

/* Đảm bảo animation không bị ảnh hưởng bởi prefers-reduced-motion */
@media (prefers-reduced-motion: reduce) {
  marquee-component .marquee__wrapper {
    animation: none !important;
  }
}

/* Keyframes cho animation */
@keyframes marquee-motion {
  0% {
    transform: translate3d(0, 0, 0);
  }
  100% {
    transform: translate3d(-50%, 0, 0);
  }
}

/* Đảm bảo hoạt động tốt trên mobile */
@media screen and (max-width: 768px) {
  .marquee__repeated-items :is(p, h1, h2, h3, h4, h5, h6, span, div) {
    font-size: 32px; /* Giảm kích thước chữ trên mobile */
  }
  
  .marquee__repeated-items img,
  .marquee__repeated-items .marquee-image {
    max-height: 50px; /* Giảm kích thước ảnh trên mobile */
  }
  
  /* Tăng tốc độ trên mobile nếu cần */
  marquee-component {
    --marquee-speed: 20s;
  }
}
{% endstylesheet %}

{% schema %}
{
  "name": "t:names.marquee",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "blocks": [
    { "type": "text" },
    { "type": "icon" },
    { "type": "logo" },
    { "type": "image" },
    { "type": "_divider" }
  ],
  "settings": [
    {
      "type": "select",
      "id": "movement_direction",
      "label": "t:settings.motion_direction",
      "options": [
        { "value": "reverse", "label": "t:options.forward" },
        { "value": "normal", "label": "t:options.reverse" }
      ],
      "default": "normal"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:settings.color_scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "t:content.padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "t:settings.top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "t:settings.bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "gap_between_elements",
      "label": "t:settings.gap",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 24
    }
  ],
  "presets": [
    {
      "name": "t:names.marquee_section",
      "category": "t:categories.text",
      "blocks": [
        { "type": "text" },
        { "type": "image" }
      ]
    }
  ]
}
{% endschema %}