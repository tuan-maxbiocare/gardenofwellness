<script 
  src="{{ 'marquee.js' | asset_url }}"
  type="module"
  fetchpriority="low"
></script>

{% assign gap_between_elements = section.settings.gap_between_elements %}

<div class="section-background color-{{ section.settings.color_scheme }}"></div>

<marquee-component
    class="section spacing-style gap-style color-{{ section.settings.color_scheme }}"
  data-speed-factor="25"
  data-movement-direction="{{ section.settings.movement_direction }}"
  data-border-mode="{{ section.settings.border_mode }}"
  style="
    {%- render 'spacing-style', settings: section.settings %};
    {% render 'gap-style', value: gap_between_elements, name: 'marquee-gap' %}
    --marquee-direction: {{ section.settings.movement_direction }};
    --marquee-border-color: {{ section.settings.border_color }};
    --marquee-border-thickness: {{ section.settings.border_thickness }}px;
  "
  data-speed-factor="25"
  data-movement-direction="{{ section.settings.movement_direction }}"
>
  <div class="marquee__wrapper" ref="wrapper">
    <div class="marquee__content" ref="content">
      <div class="marquee__repeated-items" ref="marqueeItems[]">
        {% content_for 'blocks' %}
      </div>
    </div>
  </div>
</marquee-component>

{% stylesheet %}
marquee-component{
  position: relative;
  overflow: hidden;
}

/* 2 line liền mạch, không hở */
marquee-component::before,
marquee-component::after{
  content: "";
  position: absolute;
  left: 50%;
  width: 200vw; /* full ngang, kéo không bị hở */
  height: var(--marquee-border-thickness, 1px);
  background: var(--marquee-border-color, #000);
  transform: translateX(-50%);
  z-index: 9;
  pointer-events: none;

  /* loop kỹ thuật (không bị đoạn) */
  animation: marquee-line-solid var(--marquee-speed, 25s) linear infinite;
}

marquee-component::before{ top: 0; }
marquee-component::after{ bottom: 0; }

/* đồng bộ hướng */
marquee-component[data-movement-direction="reverse"]::before,
marquee-component[data-movement-direction="reverse"]::after{
  animation-direction: reverse;
}

@keyframes marquee-line-solid{
  to { transform: translateX(-100%); }
}

/* ====== MODE CONTROL ====== */
marquee-component[data-border-mode="none"]::before,
marquee-component[data-border-mode="none"]::after{
  display: none;
}

marquee-component[data-border-mode="top"]::after{
  display: none;
}

marquee-component[data-border-mode="bottom"]::before{
  display: none;
}

/* wrapper làm mốc */
.marquee__wrapper {
  position: relative;
  display: flex;
  gap: var(--marquee-gap);
  width: max-content;
  white-space: nowrap;
  padding: 12px 0;
}

/* top */
.marquee__wrapper::before {
  top: 0;
}

/* bottom */
.marquee__wrapper::after {
  bottom: 0;
}

.marquee__content {
  min-width: max-content;
  display: flex;
  gap: var(--marquee-gap);
}

.marquee__repeated-items {
  min-width: max-content;
  display: flex;
  gap: var(--marquee-gap);
  align-items: center;
  justify-content: center;
}

/* ============================= */
/* TEXT STYLE – CHỈNH THEO Ý MUỐN */
/* ============================= */

.marquee__repeated-items :is(p, h1, h2, h3, h4, h5, h6, span, div) {
  white-space: nowrap;
  text-transform: uppercase;
  font-family: var(--font-body--family);
  font-weight: 800;
  font-size: 40px;
  margin: 0;
  line-height: 1;
  display: block;
}

/* CHỮ ĐẶC */
.marquee-solid {
  color: white !important;
  -webkit-text-stroke: 0 !important;
}

/* CHỮ RỖNG */
.marquee-outline {
  color: transparent !important;
  -webkit-text-stroke: 1.5px white !important;
}

.marquee__content .marquee__repeated-items * {
  max-width: none;
}

.marquee__repeated-items > * {
  align-content: center;
}
marquee-component {
  --marquee-speed: 25s;
}
/* Marquee chạy trên cả desktop & mobile */
marquee-component:not([data-disabled]) .marquee__wrapper {
  animation: marquee-motion var(--marquee-speed) linear infinite var(--marquee-direction);
}
/* Tôn trọng user bật Reduce Motion */
@media (prefers-reduced-motion: reduce) {
  marquee-component .marquee__wrapper {
    animation: none !important;
  }
}

@keyframes marquee-motion {
  to {
    transform: translate3d(-50%, 0, 0);
  }
}
/* ===== MOBILE: blocks thành 2 cột (thay vì xếp dọc) ===== */
@media screen and (max-width: 749px) {
  /* cho phép xuống dòng */
  .marquee__repeated-items {
    flex-wrap: wrap;
    white-space: normal;
    justify-content: flex-start;
    align-items: stretch;
  }

  /* mỗi block chiếm 1/2 hàng */
  .marquee__repeated-items > * {
    flex: 0 0 calc(50% - (var(--marquee-gap, 24px) / 2));
    max-width: calc(50% - (var(--marquee-gap, 24px) / 2));
  }

  /* nếu trong block có text đang bị nowrap thì thả ra để không “tràn” */
  .marquee__repeated-items :is(p, h1, h2, h3, h4, h5, h6, span, div) {
    white-space: normal;
  }
}

{% endstylesheet %}

{% schema %}
{
  "name": "t:names.marquee",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "blocks": [
    { "type": "text" },
    { "type": "icon" },
    { "type": "logo" },
    { "type": "_divider" }
  ],
  "settings": [
    {
      "type": "select",
      "id": "movement_direction",
      "label": "t:settings.motion_direction",
      "options": [
        { "value": "reverse", "label": "t:options.forward" },
        { "value": "normal", "label": "t:options.reverse" }
      ],
      "default": "normal"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:settings.color_scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "t:content.padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "t:settings.top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 24
    },
    {
  "type": "select",
  "id": "border_mode",
  "label": "Marquee border",
  "options": [
    { "value": "none", "label": "No border" },
    { "value": "both", "label": "Top + Bottom" },
    { "value": "top", "label": "Top only" },
    { "value": "bottom", "label": "Bottom only" }
  ],
  "default": "both"
},
{
  "type": "color",
  "id": "border_color",
  "label": "Border color",
  "default": "#000000"
},
{
  "type": "range",
  "id": "border_thickness",
  "label": "Border thickness",
  "min": 1,
  "max": 6,
  "step": 1,
  "unit": "px",
  "default": 1
},
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "t:settings.bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 24
    },
    {
      "type": "range",
      "id": "gap_between_elements",
      "label": "t:settings.gap",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 24
    }
  ],
  "presets": [
    {
      "name": "t:names.marquee_section",
      "category": "t:categories.text",
      "blocks": [
        { "type": "text" }
      ]
    }
  ]
}
{% endschema %}
