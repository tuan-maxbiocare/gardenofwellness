<section
  class="luxury-masonry-section"
  style="
    background: {{ section.settings.bg_color }};
    padding: 20px 70px;
  "
>
  {% assign media_i = 0 %}
  <div class="masonry-container">
    {% for block in section.blocks %}

      {% if block.type == 'media' %}
        {% assign media_i = media_i | plus: 1 %}
      {% endif %}

      <div
        class="masonry-item type-{{ block.type }}"
        {% if block.type == 'media' %}data-m="{{ media_i }}"{% endif %}
        {{ block.shopify_attributes }}
      >
        {% if block.type == 'media' %}
          <div class="media-wrapper"
            style="
              height: {{ block.settings.height_desktop }}px;
              --h-m: {{ block.settings.height_mobile }}px;
            ">
            {% if block.settings.video != blank %}
              {{ block.settings.video | video_tag: autoplay: true, loop: true, muted: true, playsinline: true }}
            {% elsif block.settings.image != blank %}
              {{ block.settings.image | image_url: width: 1000 | image_tag }}
            {% endif %}
          </div>
        {% endif %}

        {% if block.type == 'text' %}
          <div class="text-wrapper" style="
            background: {{ block.settings.text_bg }};
            color: {{ block.settings.text_color }};
            padding: {{ block.settings.padding }}px;
            text-align: {{ block.settings.text_align }};
          ">
            <div class="text-content" style="
              font-size: {{ block.settings.text_size }}px;
              font-weight: {{ block.settings.text_weight }};
            ">
              {{ block.settings.text }}
            </div>
          </div>
        {% endif %}
      </div>

    {% endfor %}
  </div>
</section>

{% style %}
.luxury-masonry-section {
  max-width: 1400px;
  margin: 0 auto;
}

/* Kỹ thuật CSS Columns tạo Masonry */
.masonry-container {
  column-count: 3; /* 3 cột trên Desktop */
  column-gap: 16px; /* Khoảng cách giữa các cột */
}

.masonry-item {
  break-inside: avoid; /* Quan trọng: Ngăn block bị cắt đôi khi sang cột mới */
  margin-bottom: 16px; /* Khoảng cách dưới mỗi block */
  display: block;
  width: 100%;
}

/* Media styling */
.media-wrapper {
  width: 100%;
  overflow: hidden;
  background: #f0f0f0;
}

.media-wrapper img, 
.media-wrapper video {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

/* Text styling */
.text-wrapper {
  height: auto;
  display: flex;
  flex-direction: column;
  justify-content: center;
}
  
{% endstyle %}

{% style %}
.luxury-fixed-section {
  width: 100%;
  height: var(--section-height-desktop);
  overflow: hidden;
}

.luxury-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
   grid-auto-flow: dense;
  gap: 16px;
  align-content: start;
}

/* Block */
.luxury-grid__item {
  position: relative;
  overflow: hidden;
}

/* Media */
.media-wrapper {
  width: 100%;
  overflow: hidden;
}

/* ===============================
   HOVER ZOOM MEDIA (MASONRY)
================================ */

.masonry-item .media-wrapper img,
.masonry-item .media-wrapper video {
  transition: transform 0.8s ease;
  will-change: transform;
}

.masonry-item:hover .media-wrapper img,
.masonry-item:hover .media-wrapper video {
  transform: scale(1.08);
}


/* Text */
.text-wrapper {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
}

.text-content p {
  margin: 0;
}

/* Mobile */
@media (max-width: 768px) {
  .luxury-fixed-section {
    height: var(--section-height-mobile);
  }

  .luxury-grid {
    grid-template-columns: 1fr;
  }

  .luxury-grid__item {
    height: auto !important;
  }
}

@media (max-width: 767px){

  /* 1) Cho hàng 1 (chứa text) cao theo nội dung */
  .masonry-container{
    grid-auto-rows: auto; /* ✅ hàng auto theo content */
  }

  /* 2) Text full width, chỉ chiếm 1 hàng */
  .masonry-item.type-text{
    grid-column: 1 / -1 !important;
    grid-row: 1 !important;
    margin-bottom: 10px !important; /* chỉnh gần/xa ở đây */
  }

  /* 4) Ảnh dài cột 3: span 2 hàng (tức cao gấp đôi) */
  .masonry-item.type-media:nth-child(5) .media-wrapper{
    aspect-ratio: 1 / 2;  /* cao gấp đôi ô vuông */
  }
}


/* =========================
   DESKTOP (GIỮ NGUYÊN)
   ========================= */
.luxury-masonry-section{
  max-width: 1400px;
  margin: 0 auto;
}

.masonry-container{
  column-count: 3;
  column-gap: 16px;
}

.masonry-item{
  break-inside: avoid;
  margin-bottom: 16px;
  display: block;
  width: 100%;
}

.media-wrapper{
  width: 100%;
  overflow: hidden;
  background: #f0f0f0;
}

.media-wrapper img,
.media-wrapper video{
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

/* hover zoom */
.masonry-item .media-wrapper img,
.masonry-item .media-wrapper video{
  transition: transform 0.8s ease;
  will-change: transform;
}
.masonry-item:hover .media-wrapper img,
.masonry-item:hover .media-wrapper video{
  transform: scale(1.08);
}

/* Text (giữ nguyên) */
.text-wrapper{
  height: auto;
  display: flex;
  flex-direction: column;
  justify-content: center;
}
.text-content p{ margin: 0; }


@media (max-width: 767px) { 
    .luxury-masonry-section {
         padding: 10px 0 !important; 
        } 
    .masonry-container {
         column-count: initial !important;
          display: grid !important;
           grid-template-columns: repeat(3, 1fr) !important;
            gap: 4px !important; padding: 0 !important; 
/* --- PHẦN THAY ĐỔI CHÍNH --- */ 
grid-template-rows: auto 1.6fr 1fr !important;
 grid-auto-rows: unset !important; /* Tắt auto-rows cũ */ 
}
  /* Khối TEXT */ 
  .masonry-item.type-text { 
    grid-column: 1 / -1 !important; 
    grid-row: 1 !important;
     height: auto !important; 
     padding: 0 20px 20px !important;
      margin: 0 !important; 
    } 
/* MEDIA CHUNG */ 
.masonry-item.type-media {
     margin: 0 !important;
      height: 100% !important; 
    } 
    .masonry-item.type-media .media-wrapper {
         width: 100% !important; 
         height: 100% !important;
          aspect-ratio: auto !important;
         }
 /* ĐỊNH VỊ CHÍNH XÁC TỪNG Ô */ 
 /* Cột 1 */ 
 .masonry-item:nth-child(2) { grid-column: 1; grid-row: 2 ; } /* Ảnh trên (Cao) */ 
 .masonry-item:nth-child(4) { grid-column: 1; grid-row: 3 ; } /* Ảnh dưới (Thấp) */ 
 /* Cột 2 */ 
 .masonry-item:nth-child(3) { grid-column: 2; grid-row: 2; } /* Ảnh trên (Cao) */
  .masonry-item:nth-child(5) { grid-column: 2; grid-row: 3; } /* Ảnh dưới (Thấp) */
   /* Cột 3 - Ảnh dài */
    .masonry-item:nth-child(6) { grid-column: 3 !important; grid-row: 2 / span 3 !important; /* Luôn dài bằng hàng 2 + hàng 3 */ } }


{% endstyle %}
{% schema %}
{
  "name": "Luxury Fixed Section 2.0",
  "settings": [
    {
      "type": "range",
      "id": "section_height_desktop",
      "label": "Section height desktop (px)",
      "min": 400,
      "max": 1200,
      "step": 50,
      "default": 700
    },
    {
      "type": "range",
      "id": "section_height_mobile",
      "label": "Section height mobile (px)",
      "min": 400,
      "max": 1200,
      "step": 50,
      "default": 900
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background color",
      "default": "#ffffff"
    }
  ],
  "blocks": [
    {
      "type": "media",
      "name": "Media block",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "video",
          "id": "video",
          "label": "Video"
        },
        {
          "type": "range",
          "id": "col_span",
          "label": "Column span",
          "min": 1,
          "max": 3,
          "step": 1,
          "default": 1
        },
        {
          "type": "range",
          "id": "height_desktop",
          "label": "Block height desktop (px)",
          "min": 150,
          "max": 800,
          "step": 10,
          "default": 300
        },
        {
          "type": "range",
          "id": "height_mobile",
          "label": "Block height mobile (px)",
          "min": 120,
          "max": 600,
          "step": 10,
          "default": 250
        },
        {
          "type": "range",
          "id": "padding",
          "label": "Padding (px)",
          "min": 0,
          "max": 60,
          "step": 4,
          "default": 0
        }
      ]
    },
    {
      "type": "text",
      "name": "Text block",
      "settings": [
        {
          "type": "richtext",
          "id": "text",
          "label": "Text content"
        },
        {
          "type": "color",
          "id": "text_color",
          "label": "Text color",
          "default": "#000000"
        },
        {
          "type": "color",
          "id": "text_bg",
          "label": "Background color",
          "default": "transparent"
        },
        {
          "type": "select",
          "id": "text_align",
          "label": "Text alignment",
          "options": [
            { "value": "left", "label": "Left" },
            { "value": "center", "label": "Center" },
            { "value": "right", "label": "Right" }
          ],
          "default": "left"
        },
        {
          "type": "range",
          "id": "text_size",
          "label": "Text size (px)",
          "min": 12,
          "max": 48,
          "step": 2,
          "default": 16
        },
        {
          "type": "select",
          "id": "text_weight",
          "label": "Font weight",
          "options": [
            { "value": "300", "label": "Light" },
            { "value": "400", "label": "Regular" },
            { "value": "600", "label": "Semi-bold" },
            { "value": "700", "label": "Bold" }
          ],
          "default": "400"
        },
        {
          "type": "range",
          "id": "col_span",
          "label": "Column span",
          "min": 1,
          "max": 3,
          "step": 1,
          "default": 1
        },
        {
          "type": "range",
          "id": "height_desktop",
          "label": "Block height desktop (px)",
          "min": 150,
          "max": 800,
          "step": 10,
          "default": 300
        },
        {
          "type": "range",
          "id": "height_mobile",
          "label": "Block height mobile (px)",
          "min": 120,
          "max": 600,
          "step": 10,
          "default": 250
        },
        {
          "type": "range",
          "id": "padding",
          "label": "Padding (px)",
          "min": 0,
          "max": 60,
          "step": 4,
          "default": 20
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Luxury Grid Fixed Height"
    }
  ]
}
{% endschema %}
