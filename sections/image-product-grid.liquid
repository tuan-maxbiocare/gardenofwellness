{% liquid
  capture styles
  echo '--product-columns:' | append: section.settings.columns | append: ';'
  echo '--gap-column: 24px;'
  echo '--gap-row: 24px;'

  echo '--section-padding-top:' | append: section.settings.padding_top | append: 'px;'
  echo '--section-padding-bottom:' | append: section.settings.padding_bottom | append: 'px;'
  echo '--section-padding-left:' | append: section.settings.padding_left | append: 'px;'
  echo '--section-padding-right:' | append: section.settings.padding_right | append: 'px;'

  echo '--section-padding-top-mobile:' | append: section.settings.padding_top_mobile | append: 'px;'
  echo '--section-padding-bottom-mobile:' | append: section.settings.padding_bottom_mobile | append: 'px;'
  echo '--section-padding-left-mobile:' | append: section.settings.padding_left_mobile | append: 'px;'
  echo '--section-padding-right-mobile:' | append: section.settings.padding_right_mobile | append: 'px;'
endcapture

%}


<section
  class="image-products section section--{{ section.settings.section_width }} color-{{ section.settings.color_scheme }}"
  style="{{ styles }}"
  {{ section.shopify_attributes }}
>

  <!-- TEXT HEADER -->
  {% if section.settings.heading != blank or section.settings.subheading != blank %}
    <div class="image-products__header page-width">
      {% if section.settings.heading != blank %}
        <h2 class="image-products__heading">
          {{ section.settings.heading }}
          {% if section.settings.heading_emphasis != blank %}
            <span class="image-products__heading-emphasis">
              {{ section.settings.heading_emphasis }}
            </span>
          {% endif %}
        </h2>
      {% endif %}

      {% if section.settings.subheading != blank %}
        <div class="image-products__subheading">
          {{ section.settings.subheading }}
        </div>
      {% endif %}
    </div>
  {% endif %}

  <!-- CONTENT -->
  <div class="image-products__inner page-width">

    <!-- LEFT IMAGE -->
    <div class="image-products__image">
      {% if section.settings.image != blank %}
        {{ section.settings.image
          | image_url: width: 1600
          | image_tag:
            loading: 'lazy',
            class: 'image-products__img'
        }}
      {% endif %}
    </div>

    <!-- RIGHT PRODUCTS -->
    <div class="image-products__products">
      {% if section.settings.products != blank %}
        <div class="image-products__grid">
          {% for product in section.settings.products %}
            <div class="image-products__item">
              {% content_for 'block',
                type: '_product-card',
                id: 'static-product-card',
                closest.product: product
              %}
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>

  </div>
</section>

{% stylesheet %}
.image-products {
  padding-top: var(--section-padding-top);
  padding-bottom: var(--section-padding-bottom);
  padding-left: var(--section-padding-left);
  padding-right: var(--section-padding-right);
}


@media (max-width: 768px) {
  .image-products {
    padding-top: var(--section-padding-top-mobile);
    padding-bottom: var(--section-padding-bottom-mobile);
    padding-left: var(--section-padding-left-mobile);
    padding-right: var(--section-padding-right-mobile);
  }
}


.image-products__header {
  text-align: center;
  margin-bottom: 48px;
}

.image-products__heading {
  font-size: clamp(32px, 4vw, 56px);
  font-weight: 500;
  margin: 0;
}

.image-products__heading-emphasis {
  font-style: italic;
  font-weight: 400;
  margin-left: 8px;
}

.image-products__subheading {
  margin-top: 12px;
  font-size: 16px;
  color: rgba(var(--color-foreground), 0.7);
}

/* MAIN GRID */
.image-products__inner {
  display: grid;
  grid-template-columns: 1.2fr 1fr;
  gap: 48px;
  align-items: stretch;
}

/* IMAGE */
.image-products__image {
  border-radius: 28px;
  overflow: hidden;
  position: relative;
}


.image-products__img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.8s cubic-bezier(0.25, 0.8, 0.25, 1);
  will-change: transform;
}

.image-products__image:hover .image-products__img {
  transform: scale(1.08);
}


/* PRODUCTS */
.image-products__products {
  display: flex;
}

.image-products__grid {
  display: grid;
  width: 100%;
  height: 100%;
  grid-template-columns: repeat(var(--product-columns), 1fr);
  grid-template-rows: repeat(var(--product-rows), 1fr);
  gap: var(--gap-row) var(--gap-column);
  overflow-y: auto;
}

/* MOBILE - Carousel gọn hơn, width & height nhỏ lại */
@media (max-width: 768px) {
  .image-products__header {
    margin-bottom: 32px;
  }

  /* Carousel chính - thu nhỏ height tổng thể */
  .image-products__inner {
    grid-template-columns: unset;
    display: flex;
    flex-direction: row;
    gap: 10px; /* giảm gap một chút cho gọn */
    overflow-x: auto;
    overflow-y: hidden;
    -webkit-overflow-scrolling: touch;
    padding: 0 105px 24px 16px;
    scroll-snap-type: x mandatory;
    scrollbar-width: none;
    -ms-overflow-style: none;
    height: 400px; /* Giảm từ 450px → 400px (nhỏ gọn hơn) */
    align-items: center;
  }

  .image-products__inner::-webkit-scrollbar {
    display: none;
  }

  /* Ảnh và mỗi card - thu nhỏ width + height */
  .image-products__image {
    flex: 0 0 75%;          /* Giảm từ 80% → 75% */
    max-width: 75%;
    height: 360px;          /* Giảm từ 410px → 360px */
    scroll-snap-align: start;
    border-radius: 24px;
    overflow: hidden;
  }

  .image-products__img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .image-products__products {
    display: contents;
  }

  .image-products__grid {
    display: contents;
  }

  .image-products__item {
    flex: 0 0 75%;          /* Đồng bộ với ảnh: giảm từ 80% → 75% */
    max-width: 75%;
    height: 360px;          /* Đồng bộ height */
    scroll-snap-align: start;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .image-products__item > * {
    width: 100%;
    height: 100%;
  }
}
{% endstylesheet %}

{% schema %}
{
  "name": "Image + Products",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "The Black Friday"
    },
    {
      "type": "text",
      "id": "heading_emphasis",
      "label": "Heading (italic part)",
      "default": "wellness kit."
    },
    {
      "type": "richtext",
      "id": "subheading",
      "label": "Subheading",
      "default": "<p>Four travel-sized remedies for jet lag, tension, dry skin, and summer stress.</p>"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Ảnh bên trái"
    },
    {
      "type": "product_list",
      "id": "products",
      "label": "Chọn sản phẩm"
    },
    {
      "type": "range",
      "id": "columns",
      "label": "Số cột",
      "min": 1,
      "max": 4,
      "step": 1,
      "default": 3
    },
    {
      "type": "range",
      "id": "rows",
      "label": "Số hàng",
      "min": 1,
      "max": 4,
      "step": 1,
      "default": 2
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "Section width",
      "options": [
        { "value": "page-width", "label": "Page width" },
        { "value": "full-width", "label": "Full width" }
      ],
      "default": "page-width"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1"
    },
    {
  "type": "range",
  "id": "padding_top",
  "label": "Padding top (desktop)",
  "min": 0,
  "max": 160,
  "step": 8,
  "default": 80
},
{
  "type": "range",
  "id": "padding_bottom",
  "label": "Padding bottom (desktop)",
  "min": 0,
  "max": 160,
  "step": 8,
  "default": 80
},
{
  "type": "range",
  "id": "padding_top_mobile",
  "label": "Padding top (mobile)",
  "min": 0,
  "max": 120,
  "step": 8,
  "default": 48
},
{
  "type": "range",
  "id": "padding_bottom_mobile",
  "label": "Padding bottom (mobile)",
  "min": 0,
  "max": 120,
  "step": 8,
  "default": 48
},
{
  "type": "range",
  "id": "padding_left",
  "label": "Padding left (desktop)",
  "min": 0,
  "max": 160,
  "step": 8,
  "default": 0
},
{
  "type": "range",
  "id": "padding_right",
  "label": "Padding right (desktop)",
  "min": 0,
  "max": 160,
  "step": 8,
  "default": 0
},
{
  "type": "range",
  "id": "padding_left_mobile",
  "label": "Padding left (mobile)",
  "min": 0,
  "max": 120,
  "step": 8,
  "default": 16
},
{
  "type": "range",
  "id": "padding_right_mobile",
  "label": "Padding right (mobile)",
  "min": 0,
  "max": 120,
  "step": 8,
  "default": 16
}
  ],
  "presets": [
    {
      "name": "Image + Products (full)",
      "category": "Products"
    }
  ]
}
{% endschema %}